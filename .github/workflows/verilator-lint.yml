name: Verilator Lint (Portable Subset)

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**.sv'
      - '**.svh'
      - '**.v'
      - '**.vh'
      - '.github/workflows/verilator-lint.yml'
  pull_request:
    branches: [ main ]
    paths:
      - '**.sv'
      - '**.svh'
      - '**.v'
      - '**.vh'

jobs:
  verilator-lint:
    name: Verilator Lint
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Verilator
        run: |
          sudo apt-get update
          sudo apt-get install -y ccache make autoconf g++ flex bison git perl help2man libfl-dev
          git clone https://github.com/verilator/verilator.git /tmp/verilator
          cd /tmp/verilator
          git checkout ad85d8981
          autoconf
          ./configure
          make -j$(nproc)
          sudo make install
          verilator --version

      - name: Run Verilator Lint
        run: |
          # Verilator does not fully support UVM; lint a portable subset (types/IF/assertions).
          verilator --lint-only --sv --language 1800-2017 -Wall -Wno-fatal -Wno-DECLFILENAME --bbox-unsup -DVERILATOR \
            --top-module axi4_lint_top \
            -Icommon/sv \
            -Iaxi4/sv/pkg \
            -Iaxi4/sv/if \
            common/sv/lint/axi4_lint_top.sv || true

      - name: Lint Summary
        run: echo "âœ… Verilator lint completed (non-blocking)"
